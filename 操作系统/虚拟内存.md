## 起因
需求的增长远高于技术的增长
理想中的存储器：更大、更快、更便宜的非易失性存储器
## 覆盖技术
常用代码放内存
不常用代码放硬盘
## 交换技术
把不常用的程序，没在跑的程序换到硬盘上
## 虚存技术
#### 目标
* 覆盖技术
  * 需要程序员自己把整个程序划分为若干个小的功能模块，并确定各模块之间的覆盖关系，增加了程序员负担
* 交换技术
  * 以进程作为交换单位，增加了处理器开销
1. 像覆盖技术一样，不是把程序的所有内容都放在内存中。但做的更好，由操作系统自动完成，无须程序员的干预
2. 像交换技术那样，实现进程在内存与外存间的交换，但只对进程的部分内容在内存中与外存之间进行交换
#### 程序局部性原理
程序在执行过程中的一个较短时期，所执行的指令地址和指令的操作数地址，分别限于一定区域
* 时间局部性
  * 一条指令的一次执行和下次执行，一个数据的一次访问和下次访问，都集中在一个较短的时期内
* 空间局部性
  * 当前指令和临近几条指令，当前访问的数据和临近的几个数据都集中在一个较小的区域内
#### 基本概念
可在页式或段式内存管理的基础上实现
#### 基本特征
大的用户空间
部分交换
不连续性
#### 虚拟页式内存管理
大部分虚拟存储系统都采用虚拟页式存储管理技术，即在页式存储管理的基础上，增加请求调页和页面置换功能
基本思路
* 当用户程序需要调入内存运行时，不是将程序的所有页面都装入内存，而是只装入部分页面，就可启动程序运行
* 在运行过程中，如果发现要运行的程序或要访问的数据不在内存，则向系统发出缺页中断请求，系统在处理这个中断时，将外存中相应的页面调入内存，使得内存能够继续运行。
``` mermaid
graph LR;
    逻辑页号 --> 标志位["访问位、修改位、保护位、驻留位"] --> 物理页帧号
```
|名称|作用|
|---|---|
|驻留位| 表示该页在内存中还是在外存，访问在外存中的页，产生缺页中断|
|保护位|能否访问（只读、可读写、可执行）|
|修改位|是否被修改过|
|访问位|最近是否被访问过|
缺页中断执行过程
1. 如果内存中有空闲的物理页，则分配一物理页帧，然后转到第4步，否则转到第2步
2. 启用页面置换算法，选择一个被替换的物理页帧f，它所对应的逻辑页为q，如果他被写过，则写回外存
3. 对q所对应的页表项，把驻留位修改为0
4. 将需要访问的页p装入到物理页面f当中
5. 修改p所对应的页表项的内容，把驻留位修改为1，物理页帧号修改为f
6. 重新运行被中断的指令
###### 虚存性能
$$
有效存储器访问时间（effective memory access time（EAT）= 访存时间 \times 页表命中几率 + page fault处理时间 \times pagefault几率
$$
$$
访存时间: 10ns\\
硬盘访问时间：5ms\\ 
q = dirty page 概率\\
p = page default 概率\\
EAT = 10(1 - p) + 5000000(1 + q)
$$