## 什么是进程
#### 进程定义
一个具有一定功能的程序，在一个数据集合上的一次动态执行过程
#### 进程的组成
* 程序的代码
* 处理的数据
* 程序计数器中的值，指示下一条将运行的指令
* 一组通用的计算器的当前值，堆栈
* 一组系统资源（打开的文件等）
* 进程包含了一个正在运行的程序的状态信息
* 进程与程序的联系
  * 程序是产生进程的基础
  * 程序的每次运行构成不同的进程
  * 进程是程序功能的体现
  * 通过多次执行，一个程序可以对应多个进程；通过调用关系，一个进程可以包括多个程序
* 进程与程序的区别
  * 进程是动态的，程序是静态的：程序是有序代码的集合；进程是程序的执行，进程有核心态/用户态
  * 进程是暂时的，程序是永久的：进程是一个状态变化的过程，程序可长久保存
  * 进程与程序的组成不同：进程的组成包括程序、数据和进程控制块（即进程的状态信息）
#### 进程的特点
* 动态性：可动态地创建、结束进程
* 并发性：进程可以被独立调度并占用处理机运行：并发执行
* 独立性：不同进程的工作不相互影响
* 制约性：因访问共享的数据/资源或进程同步而产生制约
#### 进程控制结构
###### 进程控制块
PCB（Process Control Block）
操作系统为每个进程都维护了一个PCB，用来保存与该进程有关的各种状态信息
定义：操作系统管理控制进程运行所用的信息集合
操作系统用PCB来描述进程的基本情况以及运行变化的过程
PCB是进程存在的唯一标志
信息:
1. 进程标识信息。如本进程的标识，产生者标识，用户标识
2. 处理机状态信息保存区。保存进程的运行现场信息
   1. 用户可见寄存器
   2. 控制和状态寄存器
   3. 栈指针
3. 进程控制信息
   1. 调度和状态信息，用于操作系统调度进程并占用处理机使用
   2. 进程间通信信息
   3. 存储管理信息
   4. 进程所用资源
   5. 有关数据结构连接信息

PCB组织方式
链表：同一状态的进程其PCB成一链表，多个状态对应不同的链表
索引表：

## 进程的状态
#### 进程的生命周期管理
###### 进程创建
引起进程创建的3个主要事件
* 系统初始化时
* 用户请求创建一个新进程
* 正在运行的进程执行了创建进程的系统调用
###### 进程运行
* 内核选择一个就绪进程，让他占用处理机并执行
###### 进程等待
* 进程只能自己阻塞自己
###### 进程唤醒
只能被操作系统或其他进程唤醒
进程由waiting转到ready
###### 进程结束
转到Done
以下四种情况，进程结束
1. 正常退出（自愿）
2. 错误推出（自愿）
3. 致命错误（强制性）
4. 被其他进程杀死（强制性）
#### 进程状态变化模型
三种基本状态
1. 运行状态（Running）
2. 就绪状态（Ready）
3. 等待状态（Blocked）
4. 创建状态（New）
5. 结束状态（Exit）
``` mermaid
stateDiagram
[*] --> New
New --> Ready : 进入就绪队列
Ready --> Running : 被调度
Ready --> Exit : 完成
Running --> Blocked : 等待事件
Blocked --> Ready : 事件发生
```
#### 进程（Suspend）挂起模型
合理且充分地利用系统资源
进程在挂起状态时，意味着进程没有占用内存空间。处在挂起状态的进程映像在磁盘上
* 阻塞挂起状态：在外存等待某事件的出现
* 就绪挂起状态：调入内存就可进入执行
与挂起相关的状态转换
* 阻塞到阻塞挂起，没有进程属于就绪态或者进程要求更多内存资源时
* 就绪到就绪挂起，高优先级阻塞进程和低优先级就绪进程，系统选择挂起低优先级就绪进程
* 运行到就绪挂起，抢占式分时，当高优先级阻塞挂起进程因事件出现而进入就绪挂起时，把运行进程转到就绪挂起
* 阻塞挂起到就绪挂起，当阻塞挂起因相关事件出现时，系统会把阻塞挂起进程转到就绪挂起进程
解挂/激活   把一个进程从外存转到内存
* 就绪挂起到就绪  没有就绪进程或挂起进程优先级高于就绪进程时
* 阻塞挂起到阻塞  当一个进程释放足够内存时，系统会把一个高优先级阻塞改期进程转换为阻塞进程
## 线程
独立运行的基本单位
进程当中的一条执行流程
进程：管理资源
线程：代码在这个资源平台上的一条执行流程
TCB Thread Control Block
优点：
* 一个进程可以同时存在多个线程
* 各个线程可以并发地执行
* 各个线程之间可以共享地址空间和文件等资源
缺点：
* 一个线程崩溃，会导致其所属进程的所有线程崩溃
``` mermaid
classDiagram
class Process {
    
}
```
#### 为什么要有线程
## 进程间通信
## 进程互斥与同步
## 死锁