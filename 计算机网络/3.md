# 网络层
## 学习目标
* 网络层协议
* 路由器

---
### 网络层协议
1. 网络层功能
    * 完成端主机之间的数据传输，实现网络间路由及决策
    * 路由（Routing）：在网络当中选择路径的过程

* TCP/IP 协议簇中的网络层协议：
    * ICMP（控制报文协议，ping）
    * IGMP（网络组播管理协议，路由器上运行）
    * IP（网际协议）
    * OSPF（选路协议，开放最短路径优先协议）
    * ...

2. IP协议（Internet Protocol）
    * 两个版本，IPV4，IPV6
    * IPV4
        1. 特点
            * 无连接协议
            * 尽力交付
            * 介质无关性（但是IP协议要考虑介质MTU,即不同介质链路能够处理的最大数据长度）
        2. 报头格式
            * 网络层IP封装：协议头  +   传输层PDU（Segment） ->  网络层PDU（Packet）
            * 协议报头：固定报头20 Bytes，最大报头 60 Bytes，扩展 4 Bytes 的倍数
                * 固定报头
                    |名称|作用|大小|
                    |---|---|---|
                    |版本|Version 4：0100||
                    |报头长度|标志IP数据包报头所占部分（因为IP报头20~60 Bytes）||
                    |服务类型|前6位区分服务<br>后两位ECN（显示拥塞位）|1 Byte|
                    |总长度|头部+数据||
                    |标识<br>标志<br>片偏移|共同完成IP数据分片的分割与组装<br>标识字段：标识唯一数据包（一个数据包各个分片标识字段一样）<br>标志字段（3bit）：最高位保留，默认为0。中间位“DF”位，为1允许分片，为0不允许。最后一位：更多分片位“MF”位，为1表示还有分片，为0表示最后一个。<br>片偏移字段：指示每一分片首位偏移原始数据包首位的长度除以8||

* 面向连接协议： 类似打电话，独占一条线
    1. 建立连接
    2. 维护链接
    3. 释放连接
* 无连接协议：不管存在、准备好，接收到

* RIP协议（Routing Information Protocol），也是选路协议，但工作在应用层（通过UDP往下发）

* 尽力交付：只管发，接什么算什么
* 可靠交付：发了什么，对方都能收到

* MTU：Max Transfer Unit
* Ethernet是 46 ~ 1500 Bytes